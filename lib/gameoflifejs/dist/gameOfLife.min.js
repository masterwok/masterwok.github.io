var GameOfLife=function(o){"use strict";var t={},e={TopLeft:0,Top:1,TopRight:2,Right:3,BottomRight:4,Bottom:5,BottomLeft:6,Left:7},n=function(o,t,e){var n={},r=function(o,t){return(t-t%o)/o};n.setCellColorAt=function(o,e,r){t.fillStyle=r,t.rect(e*n.cellWidth,o*n.cellHeight,n.cellWidth,n.cellHeight)},n.clearGrid=function(){t.clearRect(0,0,o.width,o.height)},n.nCol=r(e,o.width),n.nRow=r(e,o.height);var l=o.width-n.nCol*e,a=o.height-n.nRow*e;return n.cellWidth=l/n.nCol+e,n.cellHeight=a/n.nRow+e,n},r=document.getElementById(o.canvasId),l=r.getContext("2d");if(!r)throw"Canvas not found for given ID: "+o.canvasId;var a=null,i=[],c=null,f=0,h=null,s=0,u=function(o,t,e){return o>e?e:t>o?t:o},w=function(o,t,e){var n=0,r=0,l=0,a=o/60,i=Math.floor(a),c=a-i,f=e*(1-t),h=e*(1-t*c),s=e*(1-t*(1-c));switch(i){case 0:n=e,r=s,l=f;break;case 1:n=h,r=e,l=f;break;case 2:n=f,r=e,l=s;break;case 3:n=f,r=h,l=e;break;case 4:n=s,r=f,l=e;break;case 5:n=e,r=f,l=h;break;case 6:n=e,r=s,l=f;break;case-1:n=e,r=f,l=h;break;default:n=r=l=e}return"rgb("+Math.floor(u(255*n,0,255))+", "+Math.floor(u(255*r,0,255))+", "+Math.floor(u(255*l,0,255))+")"},C=function(){c=w(f++,1,1),f>360&&(f=0)},d=function(o){return(14&o)>>1},v=function(o,t,e,n){i[o][t]=241&e|n<<1},R=function(o,t,n){switch(o){case e.TopLeft:t-=1,n-=1;break;case e.Top:t-=1;break;case e.TopRight:t-=1,n+=1;break;case e.Right:n+=1;break;case e.BottomRight:t+=1,n+=1;break;case e.Bottom:t+=1;break;case e.BottomLeft:t+=1,n-=1;break;case e.Left:n-=1;break;default:throw"Unknown position"}return t=t>-1?t<a.nRow?t:t-a.nRow:a.nRow-1,n=n>-1?n<a.nCol?n:n-a.nCol:a.nCol-1,[t,n]},g=function(o){return 1===(1&o)},b=function(o,t){if(!g(i[o][t])){i[o][t]=1|i[o][t];for(var n in e)if(e.hasOwnProperty(n)){var r=R(e[n],o,t),l=i[r[0]][r[1]],a=d(l)+1;v(r[0],r[1],l,a)}}},k=function(o,t){if(g(i[o][t])){i[o][t]=254&i[o][t];for(var n in e)if(e.hasOwnProperty(n)){var r=R(e[n],o,t),l=i[r[0]][r[1]],a=d(l)-1;v(r[0],r[1],l,a)}}},m=function(o){for(var t=Math.floor(a.nRow*a.nCol*o),e=0;t>e;){var n=Math.floor(Math.random()*a.nRow),r=Math.floor(Math.random()*a.nCol);g(i[n][r])||(b(n,r),e++)}},M=function(o,t){return o%=a.nRow,o=0>o?o+a.nRow:o,t%=a.nCol,t=0>t?t+a.nCol:t,[o,t]},A=function(o,t,e){for(var n=null,r=e,l=0,i=1-r;r>=l;)n=M(r+o,l+t),a.setCellColorAt(n[0],n[1],c),b(n[0],n[1]),n=M(-l+o,r+t),a.setCellColorAt(n[0],n[1],c),b(n[0],n[1]),n=M(-r+o,-l+t),a.setCellColorAt(n[0],n[1],c),b(n[0],n[1]),n=M(-l+o,-r+t),a.setCellColorAt(n[0],n[1],c),b(n[0],n[1]),n=M(r+o,-l+t),a.setCellColorAt(n[0],n[1],c),b(n[0],n[1]),n=M(l+o,-r+t),a.setCellColorAt(n[0],n[1],c),b(n[0],n[1]),l++,0>i?i+=2*l+1:(r--,i+=2*(l-r+1))},p=function(o,t,e){var n,r,l;o>0&&t>o&&(l=Math.floor(Math.random()*e+1),n=Math.floor(Math.random()*(a.nRow-1)+1),r=Math.floor(Math.random()*(a.nCol-1)+1),A(n,r,l),A(n,r,l+2))},y=function(t){for(var e=0,n=new Array(t.nRow),r=0;r<t.nRow;r++)n[r]=i[r].slice();t.clearGrid(),o.cycleColors&&C(),l.beginPath();for(var a=0;a<t.nRow;a++)for(var f=0;f<t.nCol;f++)if(n[a][f]){var h=d(n[a][f]);g(n[a][f])?2!==h&&3!==h?k(a,f):(t.setCellColorAt(a,f,c),e++):3===h&&(b(a,f),t.setCellColorAt(a,f,c),e++)}p(e,s,o.maxCircleRadius||Math.floor(.2*t.nRow)),l.fill()},L=function(){h&&window.clearInterval(h),m(o.ratioAlive),h=setInterval(function(){y(a)},100)},B=function(){r.width=r.parentElement.clientWidth,r.height=r.parentElement.clientHeight,a=new n(r,l,o.cellSize),s=Math.floor(a.nRow*a.nCol*o.ratioAlive*o.circleDropThreshold),o.cycleColors||(c=o.color),i=new Array(a.nRow);for(var t=0;t<a.nRow;t++)i[t]=new Array(a.nCol);L()},T=function(){window.addEventListener("resize",B,!1),B()};return t.run=T,t};